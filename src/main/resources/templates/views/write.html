<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>write</title>
<script src="/js/tinymce/tinymce.min.js"></script>
<style>
#formDiv{
	margin-left: 40px;
	margin-top: 30px;
}
</style>
</head>
<body>
	<div id="formDiv">
		<form method="post">
			<textarea id="editor" name="editor"></textarea>
		</form>
	</div>
	<script type="text/javascript">
		window.onload=()=>{
			tinymce.init({
				license_key: "gpl",
				selector: "#editor",
				width: 850,
				height: 600,
				plugins: ["image", "media", "emoticons"],
				menubar: "",
				toolbar: "undo redo | bold italic | alignleft "+
					"aligncenter alignright alignjustify outdent indent "+
					"| image  media | forecolor backcolor emoticons",
				file_picker_types: "image",
				file_picker_callback: function(
					callback, value, meta) {
					const input = document.createElement("input");
					input.setAttribute("type", "file");
					input.setAttribute("accept", "image");

					input.onchange = async function(){
						const file = this.files[0];
						const formData = new FormData();
						formData.append("file",file);

						try{
							const response = await fetch("api/upload");

							if(!response.ok){
							throw new Error("upload failed");
							}

							const data = await response.json();
							//컨트롤러에서 반환하는 return ResponseEntity.ok("/uploads/" + "uniqueFilename"); 이게 json객체라는 뜻.

							callback(data.imageUrl);
						}catch(error){
							console.error("file upload failed : ", error);
						}
					}
					input.click();//
				},
				statusbar: false,
				promotion: false
			});
		}
	</script>
</body>
</html>